# 编辑器工具栏响应式规则说明

> 本文档用于确认编辑器工具栏的响应式折叠逻辑。

---

## 一、工具栏结构

工具栏按钮分为 **两段**，从左到右依次排列：

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  [文本区域] ······························ | ········ [插入区域]  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**两个区域之间有分隔线 `|`**

---

## 二、文本区域（Text Options）

从左到右排列顺序如下：

| 组ID | 包含功能 | 控件类型 | 图标/备注 |
|------|---------|---------|----------|
| **history** | 撤销、重做 | 2个图标按钮 | `Undo2`, `Redo2` |
|  | **分隔线** | | |
| **painter** | 格式刷、清除格式 | 2个图标按钮 | `Paintbrush`, `Eraser` |
|  | **分隔线** | | |
| **textType** | 段落样式 | 下拉菜单 | 正文/标题1/2/3 |
| **fontFamily** | 字体 | 下拉菜单 | 鸿蒙黑体/宋体/楷体 |
| **fontSize** | 字号下拉、增大、减小 | 下拉菜单 + 2个图标按钮 | 字号选择 + `AArrowUp`, `AArrowDown` |
|  | **分隔线** | | |
| **colors** | 文字颜色、背景颜色 | 2个颜色选择器按钮 | `Palette`, `Highlighter` |
|  | **分隔线** | | |
| **basic** | 粗体、斜体、下划线 | 3个图标按钮 | `Bold`, `Italic`, `Underline` |
| **advanced** | 删除线、上标、下标 | 3个图标按钮 | `Strikethrough`, `Superscript`, `Subscript` |
|  | **分隔线** | | |
| **align** | 对齐方式 | 下拉菜单 | `AlignLeft` → 左/中/右对齐 |
| **list** | 列表 | 下拉菜单 | `List` → 无序/有序列表 |
| **indent** | 缩进 | 下拉菜单 | `Indent` → 增加/减少缩进 |
| **lineHeight** | 段落间距 | 下拉菜单 | `AlignJustify` → 1.0/1.5 |
|  | **分隔线** | | |
| **utils** | 查找替换、代码模式 | 2个图标按钮 | `Search`, `Code` |
| ▼ | **文本更多** | 图标按钮 | `CircleEllipsis`（当有功能被折叠时显示） |

---

## 三、插入区域（Insert Options）

从左到右排列顺序如下：

| 序号 | 功能 | 控件类型 | 图标 | 可折叠 |
|:---:|------|---------|------|:-----:|
| 1 | 图片 | 图标按钮 | `Image` | ❌ 始终可见 |
| 2 | 表格 | 图标按钮 | `Table` | ❌ 始终可见 |
| 3 | 链接 | 图标按钮 | `Link` | ✅ |
| 4 | 表情 | 图标按钮 | `Smile` | ✅ |
| 5 | 分割线 | 图标按钮 | `Minus` | ✅ |
| ▼ | **插入更多** | 图标按钮 | `CircleEllipsis`（当有功能被折叠时显示） | — |

---

## 四、响应式规则

### 4.1 最小展示保证

| 区域 | 最小展示内容 | 备注 |
|------|-------------|------|
| 文本区域 | **无最小要求** | 极端情况下可全部折叠，只剩"文本更多"按钮 |
| 插入区域 | 图片、表格、插入更多 | 这 3 项始终可见 |

### 4.2 展示原则

1. **尽可能展示最多功能**：在当前容器宽度下，尽量展示最多的功能按钮
2. **宁可留白，不可截断**：如果剩余空间不足以放下一个**完整**的功能图标，则不展开，右侧留白
3. **逐个展开**：每次只展开一个完整功能，不会同时展开多个
4. **无动画**：展开/收起时直接显示/隐藏，不需要动画效果

### 4.3 "更多"按钮的行为

- **可见性**：只要该区域有被折叠的功能，该区域的"更多"按钮就**始终可见**
- **展开时机**：只有当容器宽度足以容纳一个**完整**的功能图标时，才会展开下一个功能
- **功能全部展开后**：该区域的"更多"按钮**消失**

### 4.4 "更多"下拉菜单样式

- **布局**：图标 + 文字的列表样式
- **下拉选项**：变成**级联菜单**（如果该功能本身有子菜单）

---

## 五、展开/收起优先级

### 5.1 展开顺序（容器变宽时）

```
第1步：展开文本区域的功能（按组ID顺序逐个展开）
        history → painter → textType → fontFamily → fontSize → colors 
        → basic → advanced → align → list → indent → lineHeight → utils

第2步：文本区域全部展开后，再展开插入区域的功能
        link → smile → minus
```

### 5.2 收起顺序（容器变窄时）

```
第1步：收起插入区域的功能（从右到左逐个收起）
        minus → smile → link → 至最小状态（图片、表格、插入更多）

第2步：插入区域收到最小状态后，再收起文本区域的功能
        utils → lineHeight → indent → list → align → advanced → basic 
        → colors → fontSize → fontFamily → textType → painter → history
```

---

## 六、示意图

### 6.1 宽屏状态（全部展开）

```
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ [↶][↷] │ [🖌][✕] │ [正文▼] [鸿蒙黑体▼] [16px▼ ↑ ↓] │ [🎨][🖍] │ [B][I][U] [S][ˣ][ₓ] │ [≡▼][≣▼][⇥▼][⫶▼] │ [🔍][</>]  │  [🖼][⊞][🔗][😊][—]  │
│  撤销重做   格式刷清除    段落样式   字体        字号 增大减小     颜色 背景   粗斜下划 删上下标     对齐列表缩进行高     搜索代码       图表链接表情线 │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                          ↑                                                                              ↑
                                  文本区域（全部展开，无"更多"按钮）                                           插入区域（全部展开，无"更多"按钮）
```

### 6.2 中等宽度（部分折叠）

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ [↶][↷] │ [🖌][✕] │ [正文▼] [鸿蒙黑体▼] [16px▼ ↑ ↓] │ [🎨][🖍] │ [B][I][U] [···]  │  [🖼][⊞][···]  │
│  撤销重做   格式刷清除    段落样式   字体        字号 增大减小     颜色 背景   粗斜下划 更多       图片表格 更多     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                        ↑              ↑
                                                              文本更多按钮     插入更多按钮
```

### 6.3 窄屏状态（最小展示）

```
┌──────────────────────────────────────────────────────────┐
│ [···]  │  [🖼][⊞][···]                                   │
│ 文本更多    图片表格 插入更多                              │
└──────────────────────────────────────────────────────────┘
    ↑               ↑
  文本区域         插入区域
  最小状态         最小状态
```

---

## 七、确认的答案汇总

| 问题 | 答案 |
|------|------|
| "更多"按钮数量 | ✅ 各有一个（文本更多 + 插入更多） |
| 文本区域最小展示 | ✅ 无要求，可全部折叠只剩"更多"按钮 |
| 展开顺序 | ✅ 串行：先文本项全部展开，再展开插入项 |
| 两段分隔 | ✅ 有分隔线 |
| 动画效果 | ✅ 不需要，直接显示/隐藏 |
| 更多菜单样式 | ✅ 图标+文本列表，有子菜单的变级联菜单 |
| 插入更多内容 | ✅ 链接、表情、分割线（无附件） |

---

## 八、技术实现要点

- [x] 使用 `ResizeObserver` 监听容器宽度变化
- [x] 计算每个功能组的宽度（当前已有 `TEXT_GROUPS` 和 `INSERT_VARIABLES` 定义）
- [x] 维护优先级队列，决定展开/收起的顺序
- [x] 文本区域和插入区域各有一个"更多"按钮
- [x] "更多"按钮使用下拉菜单展示被折叠的功能
- [x] 无需动画效果
- [ ] **待实现**：级联菜单（对于有子选项的功能如对齐、列表、缩进等）

---

*文档更新时间：2026-01-18*
